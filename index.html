<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>devJwon's Blog</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.8;
            color: #1a1a1a;
            background: #ffffff;
            font-size: 16px;
        }

        .container {
            max-width: 720px;
            margin: 0 auto;
            padding: 0 24px;
        }

        header {
            border-bottom: 1px solid #e0e0e0;
            padding: 4rem 0 2rem;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #000;
            letter-spacing: -0.02em;
        }

        .subtitle {
            font-size: 1rem;
            color: #666;
            font-weight: 400;
        }

        nav {
            padding: 2rem 0;
            border-bottom: 1px solid #e0e0e0;
        }

        nav ul {
            list-style: none;
            display: flex;
            gap: 1.5rem;
        }

        nav a {
            text-decoration: none;
            color: #1a1a1a;
            font-size: 0.95rem;
            font-weight: 500;
            transition: color 0.2s;
        }

        nav a:hover {
            color: #666;
        }

        main {
            padding: 3rem 0;
            min-height: 60vh;
        }

        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: #000;
            color: #fff;
            text-decoration: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: opacity 0.2s;
        }

        .btn:hover {
            opacity: 0.8;
        }

        .btn-outline {
            background: #fff;
            color: #000;
            border: 1px solid #000;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #fff;
            padding: 2rem;
            max-width: 720px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e0e0e0;
        }

        .modal-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #000;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #1a1a1a;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e0e0e0;
            font-family: inherit;
            font-size: 1rem;
        }

        .form-group textarea {
            min-height: 200px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .post-actions {
            margin-top: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .about-section {
            padding: 2rem 0;
            margin-bottom: 3rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .about-section h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #000;
        }

        .about-section p {
            color: #4a4a4a;
            line-height: 1.8;
        }

        .posts-header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e0e0e0;
        }

        .posts-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #000;
        }

        .post-grid {
            display: grid;
            gap: 3rem;
        }

        .post-card {
            padding-bottom: 3rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .post-card:last-child {
            border-bottom: none;
        }

        .post-date {
            color: #999;
            font-size: 0.875rem;
            margin-bottom: 0.75rem;
            letter-spacing: 0.02em;
        }

        .post-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #000;
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        .post-excerpt {
            color: #4a4a4a;
            line-height: 1.8;
            margin-bottom: 1rem;
        }

        .read-more {
            display: inline-block;
            color: #1a1a1a;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            border-bottom: 1px solid #1a1a1a;
            padding-bottom: 2px;
            transition: opacity 0.2s;
        }

        .read-more:hover {
            opacity: 0.6;
        }

        footer {
            border-top: 1px solid #e0e0e0;
            padding: 3rem 0;
            margin-top: 5rem;
        }

        footer p {
            color: #666;
            font-size: 0.875rem;
            text-align: center;
        }

        footer .emoji {
            color: #999;
        }

        @media (max-width: 768px) {
            header {
                padding: 3rem 0 1.5rem;
            }

            h1 {
                font-size: 1.75rem;
            }

            nav {
                padding: 1.5rem 0;
            }

            nav ul {
                gap: 1rem;
            }

            main {
                padding: 2rem 0;
            }

            .post-title {
                font-size: 1.25rem;
            }

            .post-grid {
                gap: 2rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>이재원 Blog</h1>
            <p class="subtitle">AI 프로젝트와 스터디 기록</p>
        </div>
    </header>

    <nav>
        <div class="container">
            <ul>
                <li><a href="#home">홈</a></li>
                <li><a href="#about">소개</a></li>
                <li><a href="#posts">포스트</a></li>
                <li><a href="#contact">연락</a></li>
                <li><a href="#" onclick="showTokenSettings(event)" style="color: #666;">⚙️ 설정</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <section class="about-section" id="about">
            <h2>안녕하세요</h2>
            <p>AI를 공부하며 배운 것들을 기록하는 공간입니다. 인공지능, 새로운 기술, 그리고 AI 프로덕트 개발 과정에서의 경험들을 공유합니다.</p>
        </section>

        <section id="posts">
            <div class="posts-header" style="display: flex; justify-content: space-between; align-items: center;">
                <h2>최근 포스트</h2>
                <button class="btn" onclick="openPostModal()">새 포스트 작성</button>
            </div>

            <div class="post-grid" id="postGrid">
                <!-- 포스트가 여기에 동적으로 추가됩니다 -->
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 이재원 Blog</p>
            <p style="margin-top: 0.5rem;" class="emoji">Made with HTML</p>
        </div>
    </footer>

    <!-- 포스트 작성/수정 모달 -->
    <div id="postModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">새 포스트 작성</h2>
                <button class="close-btn" onclick="closePostModal()">&times;</button>
            </div>
            <form id="postForm" onsubmit="savePost(event)">
                <div class="form-group">
                    <label for="postTitle">제목</label>
                    <input type="text" id="postTitle" required>
                </div>
                <div class="form-group">
                    <label for="postContent">내용</label>
                    <textarea id="postContent" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closePostModal()">취소</button>
                    <button type="submit" class="btn">저장</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let posts = [];
        let editingPostId = null;

        // GitHub 설정
        const GITHUB_CONFIG = {
            owner: 'devJwon',  // GitHub 사용자명으로 변경하세요
            repo: 'devJwon.github.io',  // 저장소 이름
            branch: 'main',
            filePath: 'posts.json'
        };

        // 초기 데이터 로드
        async function loadPosts() {
            try {
                // GitHub에서 posts.json 가져오기
                const response = await fetch(`https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/${GITHUB_CONFIG.branch}/${GITHUB_CONFIG.filePath}`);
                if (response.ok) {
                    posts = await response.json();
                } else {
                    throw new Error('File not found');
                }
            } catch (error) {
                console.log('GitHub에서 포스트를 불러올 수 없습니다. 기본 포스트를 사용합니다.');
                // 기본 예시 포스트
                posts = [
                    {
                        id: Date.now(),
                        title: 'GitHub Pages로 블로그 시작하기',
                        content: 'GitHub Pages를 이용해서 간단하게 블로그를 만드는 방법을 소개합니다. 복잡한 설정 없이 HTML만으로도 충분히 멋진 블로그를 만들 수 있어요!',
                        date: '2025-10-20'
                    },
                    {
                        id: Date.now() - 1,
                        title: 'HTML/CSS 기초 다지기',
                        content: '웹 개발의 기본인 HTML과 CSS를 공부하면서 배운 내용들을 정리했습니다. 기본이 튼튼해야 나중에 더 복잡한 것들도 쉽게 배울 수 있겠죠?',
                        date: '2025-10-15'
                    },
                    {
                        id: Date.now() - 2,
                        title: '첫 포스팅!',
                        content: '드디어 블로그를 시작했습니다! 앞으로 이곳에 개발 공부 내용과 프로젝트 경험들을 차근차근 기록해나갈 예정입니다.',
                        date: '2025-10-10'
                    }
                ];
            }
            renderPosts();
        }

        // GitHub에 푸시
        async function pushToGitHub() {
            const token = localStorage.getItem('githubToken');

            if (!token) {
                const userToken = prompt('GitHub Personal Access Token을 입력하세요:\n\n1. GitHub.com → Settings → Developer settings\n2. Personal access tokens → Tokens (classic)\n3. Generate new token\n4. "repo" 권한 선택\n\n토큰:');

                if (!userToken) {
                    alert('토큰이 없으면 GitHub에 저장할 수 없습니다.');
                    return false;
                }

                localStorage.setItem('githubToken', userToken);
                return pushToGitHub(); // 재시도
            }

            try {
                // 1. 현재 파일의 SHA 가져오기
                let sha = null;
                try {
                    const getResponse = await fetch(
                        `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.filePath}`,
                        {
                            headers: {
                                'Authorization': `token ${token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        }
                    );

                    if (getResponse.ok) {
                        const data = await getResponse.json();
                        sha = data.sha;
                    }
                } catch (error) {
                    console.log('기존 파일이 없습니다. 새로 생성합니다.');
                }

                // 2. 파일 업데이트 또는 생성
                const content = btoa(unescape(encodeURIComponent(JSON.stringify(posts, null, 2))));

                const updateResponse = await fetch(
                    `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.filePath}`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: `Update blog posts - ${new Date().toLocaleString('ko-KR')}`,
                            content: content,
                            branch: GITHUB_CONFIG.branch,
                            ...(sha && { sha })
                        })
                    }
                );

                if (!updateResponse.ok) {
                    const error = await updateResponse.json();
                    throw new Error(error.message || 'GitHub 업데이트 실패');
                }

                alert('✅ GitHub에 저장되었습니다! 잠시 후 블로그가 업데이트됩니다.');
                return true;

            } catch (error) {
                console.error('GitHub 푸시 실패:', error);

                if (error.message.includes('Bad credentials')) {
                    localStorage.removeItem('githubToken');
                    alert('❌ 토큰이 유효하지 않습니다. 다시 입력해주세요.');
                } else {
                    alert(`❌ GitHub 저장 실패: ${error.message}`);
                }

                return false;
            }
        }

        // 포스트 렌더링
        function renderPosts() {
            const postGrid = document.getElementById('postGrid');
            postGrid.innerHTML = '';

            posts.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(post => {
                const postCard = document.createElement('article');
                postCard.className = 'post-card';

                const dateStr = new Date(post.date).toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                postCard.innerHTML = `
                    <div class="post-date">${dateStr}</div>
                    <h3 class="post-title">${post.title}</h3>
                    <p class="post-excerpt">${post.content}</p>
                    <div class="post-actions">
                        <button class="btn btn-small btn-outline" onclick="editPost(${post.id})">수정</button>
                        <button class="btn btn-small btn-outline" onclick="deletePost(${post.id})">삭제</button>
                    </div>
                `;

                postGrid.appendChild(postCard);
            });
        }

        // 모달 열기
        function openPostModal(postId = null) {
            const modal = document.getElementById('postModal');
            const modalTitle = document.getElementById('modalTitle');
            const postTitle = document.getElementById('postTitle');
            const postContent = document.getElementById('postContent');

            if (postId) {
                const post = posts.find(p => p.id === postId);
                if (post) {
                    editingPostId = postId;
                    modalTitle.textContent = '포스트 수정';
                    postTitle.value = post.title;
                    postContent.value = post.content;
                }
            } else {
                editingPostId = null;
                modalTitle.textContent = '새 포스트 작성';
                postTitle.value = '';
                postContent.value = '';
            }

            modal.classList.add('active');
        }

        // 모달 닫기
        function closePostModal() {
            const modal = document.getElementById('postModal');
            modal.classList.remove('active');
            editingPostId = null;
        }

        // 포스트 저장
        async function savePost(event) {
            event.preventDefault();

            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;

            if (editingPostId) {
                // 수정
                const post = posts.find(p => p.id === editingPostId);
                if (post) {
                    post.title = title;
                    post.content = content;
                }
            } else {
                // 새 포스트
                const newPost = {
                    id: Date.now(),
                    title: title,
                    content: content,
                    date: new Date().toISOString().split('T')[0]
                };
                posts.push(newPost);
            }

            // GitHub에 자동 푸시
            const success = await pushToGitHub();

            if (success) {
                renderPosts();
                closePostModal();
            }
        }

        // 포스트 수정
        function editPost(postId) {
            openPostModal(postId);
        }

        // 포스트 삭제
        async function deletePost(postId) {
            if (confirm('정말로 이 포스트를 삭제하시겠습니까?')) {
                posts = posts.filter(p => p.id !== postId);

                // GitHub에 자동 푸시
                const success = await pushToGitHub();

                if (success) {
                    renderPosts();
                }
            }
        }

        // 모달 외부 클릭시 닫기
        window.onclick = function(event) {
            const modal = document.getElementById('postModal');
            if (event.target === modal) {
                closePostModal();
            }
        }

        // 토큰 설정 표시
        function showTokenSettings(event) {
            event.preventDefault();

            const currentToken = localStorage.getItem('githubToken');
            const message = currentToken
                ? '현재 GitHub 토큰이 설정되어 있습니다.\n\n새 토큰을 입력하거나 취소를 누르면 기존 토큰이 유지됩니다.\n\n토큰 삭제를 원하시면 빈 값을 입력하세요.'
                : 'GitHub Personal Access Token을 입력하세요:\n\n1. GitHub.com → Settings → Developer settings\n2. Personal access tokens → Tokens (classic)\n3. Generate new token\n4. "repo" 권한 선택';

            const newToken = prompt(message, '');

            if (newToken === '') {
                // 빈 값 입력시 토큰 삭제
                localStorage.removeItem('githubToken');
                alert('토큰이 삭제되었습니다.');
            } else if (newToken) {
                // 새 토큰 저장
                localStorage.setItem('githubToken', newToken);
                alert('토큰이 저장되었습니다.');
            }
        }

        // 페이지 로드시 포스트 불러오기
        loadPosts();
    </script>
</body>
</html>
